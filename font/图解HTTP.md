# 图解HTTP

[toc]

## temp

TCP/IP： 应用层、传输层、网络层、数据链路层

http请求	分割，标记序号和端口号	MAC地址

IP地址的两个重要的条件： IP地址和MAC地址（Media Access Control Access）

ip地址是节点被分配的地址，mac地址是网卡所属的固定地址

ARP协议凭借 MAC地址进行通信，根据通信方的 ip地址就可以反查出对应的 mac地址

tcp提供可靠的字节流服务，为了准确的将数据送到目标，tcp协议采用了三次握手策略： 标有syn的数据包发给你了， 我收到你发给我的数据包了（syn/ack的数据包），明白（发送ack的数据包）

DNS（domain name system）服务是和http协议一样位于应用层的协议，它提供域名到ip地址之间的解析服务： 我想访问某网页，把它的IP告诉我吧， 它是xx， 我向xx发送请求了

http协议的职责是生成针对目标web服务器的http请求报文

URI  和 URL(uniform resource locator)

请求报文的构成：方法、uri、协议版本、请求首部字段、内容实体

响应报文的构成：协议版本 状态码 原因短语 响应首部字段 主体

http是一种不保存状态的协议，但是有了Cookie就可以管理状态了

HTTP方法： get：我想访问你的某个资源啊   post：我要把这条信息告诉你	put：我要把这份文件传给你	head：把那个相关的信息告诉我	delete：快把那份文件删掉吧	options：你支持哪些方法哇	connect：让我通过一下吧

必须进行多次通信好累啊，所有连接默认都是持久连接

管线化可以看成是异步吗

cookie技术通过在请求和响应报文中写入cookie信息来控制客户端的状态，cookie会根据从服务端发送的响应报文中的一个叫做set-cookie的首端字段信息，通知客户端保存cookie，下次客户端再往该服务器发送请求时会自动在报文中加入cookie		生成cookie，记住是向谁发送的	啊，原来是刚才那家伙哇

http报文大致可以分为报文首部和报文主题两块

编码以提升传输速率：  紧紧的压缩

多部分对象集合包含的对象如下： multipart/form-data    multipart/byteranges

range:  把那剩余的部分给我 206

内容协商（content negotiation）返回最合适的内容

状态码告知从服务器端返回结果：2xx，进展很顺利	4xx，5xx似乎不行啊

1正在处理	2正常处理完毕	3重定向	4服务器无法处理请求	5服务器处理请求出错

204 没资源返回	206我只要一部分	301资源的uri已经更新，你也更新一下吧	302资源临时定位到其它位置了，暂时你换个uri访问吧	303uri已经更新，你要按新的来访问吗	304资源已找到，但是不符合要求	307我和302差不多

400 我无法理解这个请求，是不是错了	401我需要认证的	403不允许访问那个资源啊	404服务器上没有该资源啊	500貌似内部资源出故障了	503抱歉，我正在忙呢

状态码和状态经常不一致，有时候后端已经出错了，但是也返回了 200 ok 的状态码

用单台虚拟主机实现多个域名，若是部署在同一个服务器上，它们的ip地址会相同，由于相同的ip地址，所以在发送HTTP请求时必须在host首部内完整指定主机名或域名的uri

通信数据转发程序：代理、网关、隧道

报文首部：在客户端和服务器处理时起至关重要作用的信息几乎都在这里	报文主体：所需要的用户和资源的信息都在这里

HTTP首部字段传递重要信息，首部字段是由首部字段名和字段值组成，中间用： 分隔，首部字段分为以下四种：通用首部字段、请求首部字段、响应首部字段、实体首部字段

端到端首部，逐跳首部

Cache-Control操作缓存的工作机制：如果有缓存请给我、我喜欢你不要对此做缓存

Cache-Control: private：这份缓存只可以提供给那个家伙使用喔

Cache-Control: no-cache：我不要缓存过的，请给我从源服务器那里拿来资源	你可以缓存，但每次使用前先向我确认一下

Cache-Control: max-age=604800：要是缓存没超过一周，就把他给我吧	一周内不必向我确认，你直接支配该缓存就好了

Connection: 控制不在转发给代理的首部字段，管理持久连接：把这个删除后再转发喔	这下我和你的关系结束了

Accept：该字段可通知服务器，用户代理能够处理的媒体类型以及媒体类型的优先级



http + 加密 + 认证 + 完整性 = https



- websocket



## 了解Web及网络基础

### 框架

TCP/IP协议簇分为四层：应用层（FTP（file transition protocol）、DNS（domain name system））、传输层（TCP（transition control protocol）、UDP（user data protocol））、网络层（Internet protocol）、链路层

![image-20211115105259766](D:\NNU\笔记\picture/image-20211115105259766.png)

<div align='center'>TCP/IP通信传输流</div>

### 负责传输的IP协议

TCP/IP协议簇的IP指的就是网络协议，在名称中就占据了一半的位置，可见其重要性。

IP协议是 Internet Protocol，它包括 IP 地址和 MAC(media access control address) [IP 地址和 MAC地址的区别](https://blog.csdn.net/guoweimelon/article/details/50858597)

![img](D:\NNU\笔记\picture/20160311202637585)

IP协议的作用是把各种数据包传送给对方，而要保证确实传送到对方那里，则需要满足各类条件，其中最重要的两个条件是 IP 地址和 MAC 地址，IP地址指明了节点被分配的地址，MAC地址指明了网卡所属的固定地址

#### 利用 ARP 协议凭借 MAC 地址进行通信

IP 间的通信依赖 MAC 地址，在网络上，通信的双方在同一局域网（LAN）的情况是很少的，通常要经过多次中转才能连接对方。而在进行中转时，会利用下一站中转设备的MAC地址来搜索下一个中转目标。ARP协议通过ip地址反查出mac地址

### 确保可靠性的 TCP 协议

TCP协议位于传输层，提供可靠的字节流服务

字节流服务：为了方便将大块数据分割以报文段（segment）为单位的数据包进行管理。TCP协议为了更容易传送大数据才把数据分割，而TCP协议能够确认数据最终是否传送给了对方

#### 确保数据能够到达目标

为了确保无误的将数据送达目标处，TCP协议采用了三次握手（three-way handshaking），四次挥手策略

[三次握手，四次挥手](https://www.zhihu.com/question/271701044/answer/2194334244)

### 其它

DNS（Domain Name System）服务是和HTTP协议一样位于应用层的协议，它提供域名到IP地址之间的解析服务

![1.6 各种协议与HTTP 协议的关系- wslxq - 博客园](../image/2510762-20211018192324793-410583087.jpg)

<div align='center'>各种协议与HTTP协议之间的关系</div>

URL(uniform resource locator) 统一资源定位符

URI（uniform resource identifier）统一资源标识符

url 就是使用定位的方式实现  uri

## 简单的HTTP协议











# 其它

## Content-Type

[MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type)

Content-Type 实体头部用于指示资源的 MIME 类型(media type，指示文件类型的字符串)

在响应中，Content-Type 标头告诉客户端实际返回的内容的内容类型；在请求中（如 POST 或 PUT），客户端告诉服务端实际发送的数据类型

句法：

```json
Content-Type: text/html; charset=utf-8
Content-Type: multipart/form-data; boundary=something
```

### Content-Type 在 HTML 表单中

在通过 HTML form 提交生成的 POST 请求中，请求头的 Content-Type 由 form 元素上的 enctype 属性指定

```html
<form action='/' method='POST' enctype='multipart/form-data'>
    <input type='text' name='decription' value='some text'>
    <button type='submit'>
        Submit
    </button>
</form>
```

请求头看起来像这样（在这里省略了一些 headers）：

```tex
POST /foo HTTP/1.1
Content-Length: 68137
Content-Type: multipart/form-data; boundary=---------------------------974767299852498929531610575

---------------------------974767299852498929531610575
Content-Disposition: form-data; name="description"

some text
---------------------------974767299852498929531610575
Content-Disposition: form-data; name="myFile"; filename="foo.txt"
Content-Type: text/plain

(content of the uploaded file foo.txt)
---------------------------974767299852498929531610575
```

MDN 的内容有点少啊，又看了一下简书的内容， [Content-Type](https://www.jianshu.com/p/de5845b4c095)

### 常见的 Content-Type

- HTML文档标记 ：text/html
- 普通ASCII 文档标记： text/html
- JPEG 图片标记：image/jpeg
- gif 图片编辑：image/gif
- js文档标记： application/javascript
- xml文件标记： application/xml

#### application/x-www-form-urlencoded

HTTP会将请求参数用 key1 = val1 & key2 = val2 的方式进行组织，并放到请求实体里面，如果是中文或特殊字符则会自动进行URL转码，一般用于表单提交，不支持文件

- 请求

![img](../image/12665637-729025bc77ed1873.png)

- http 请求报头

![img](../image/12665637-930e17c6c5bcc45c.png)

#### multipart/form-data

与 application/x-www-form-urlencoded 不同，这是一个多部分多媒体类型，首先生成了一个 boundary 用于分割不同字段，在请求实体里每个参数以 --------boundary 开始，然后是附加信息和参数名，然后是空行，最后是参数内容。多个参数将会有多个 boundary 块，如果参数是文件会有特别的文件域。最后以 ------boundary- 为结束标志，multipart/form-data 支持文件上传的格式，一般需要上传文件的表单则用该类型

- 请求参数

![img](../image/12665637-1d19274c5459010d.png)

- http 请求报文

![img](../image/12665637-2007827c11fd29c2.png)

#### application/json

json是一种轻量级的数据格式，以键值对的方式组织的数据，使用这个类型，需要参数本身就是json格式的数据，参数会被直接放到请求实体里，不进行任何处理，服务端/客户端会按json格式解析数据（约定好的情况下）

- 请求参数

![img](../image/12665637-4fda490cd2892687.png)

- http 请求报文

![img](../image/12665637-547c2c6b2470c6d2.png)

#### application/xml 和 text/xml

与application/json类似，这里用的是xml格式的数据，text/xml的话，将忽略xml数据里的编码格式

### Content-Type的使用

### request 的 Content-Type

一般我们在开发过程中需要注意客户端发送请求（Request）的 Content-Type 设置，特别是使用 ajax 的时候，如果设置得很不准确，很有可能会导致请求失败。比如在 spring 中，如果接口使用了 @RequestBody，spring 强大的自动解析功能，会将请求实体的内容自动转换为 Bean，但前提是请求的 Content-Type 必须设置为 application/json，否则会返回 415 错误

- 415 unsupported media type，即不支持的媒体类型

建议：

1. 如果是一个 restful 接口（json格式），一般将 Content-Type 设置为 application/json; charset=utf-8
2. 如果是文件上传，一般是设置为 multipart/form-data
3. 如果是普通的表单提交，一般是设置为 application/x-www-form-urlencoded

### response 的 Content-Type

服务端响应（response）的 Content-Type 最好也保持准确，虽然一般 web 开发中，前端解析响应的数据不会根据 Content-Type，并且服务端一般能自动设置准备的 Content-Type，但是如果乱设置的情况下可能会有些问题，比如导出文件，比如导出文件，打开图片等，如果在 spring 项目里使用 @ResponseBody，spring 会将响应的 Content-Type 设置为 application/json； charset=utf-8；可能会导致文件无法导出

response 的 Content-Type 设置建议：

1. 一般情况下不需要显示设置

2. 如果是文件导出，Content-Type 设置为 mulitpart/form-data，并且添加一个 Content-Disposition  设置为 attachment;fileName =文件.后缀

   注：Content-Disposition 是 Content-Type 的扩展，它告诉浏览器弹窗下载框

例子：

未正确设置 response 的 Content-Type 的情况，客户端会将 json 数据当成普通文本  Content-Type: text/html;charset=utf-8

![img](../image/12665637-acfa780201f54f9d.png)

正确设置 response 的Content-Type 的情况，客户端将 json 数据自动解析 Content-Type: application/json; charset=utf-8

![img](../image/12665637-9f5359fd3723fb61.png)



## 子网划分、子网掩码

[网络基础知识_子网划分](https://www.cnblogs.com/wj-1314/p/8302473.html)

### 基础

![img](../image/1226410-20180117130813740-482016640.png)

#### 网络发展过程

计算机与通信的融合过程就是计算机网络的发展过程，利用通信线路把位于不同的点上的多个计算机系统相互连接起来便形成了计算机网络，在网络中，通过功能完善的网络软件的管理，可以共享某些软件、硬件和数据资源。计算机网络的发展经历了三个阶段：具有通信功能的单机系统，具有通信功能的多级系统和计算机网络

#### LAN

局域网（LAN）的发展：LAN 有三种基本的拓扑结果：总线型，环形，星型，市场提供三种使用的传输介质：双绞线，电缆和光纤

### ip地址的定义和分类

#### 定义

ip地址是唯一标识网络上的计算机，ip 由一个 32 位的0，1字符串组成，额也可以点分十进制表示，网络中每个路由或者主机都会拥有一个独一无二的 ip 地址用来区分用户，根据 tcp/ip 协议，连接在 Internet 上的每个设备都必须有一个 ip 地址

![img](../image/1226410-20180117212752131-132130429.png)

<div align='center'>ip 地址表示</div>

#### 分类

32bit的ip地址被分为两个部分：网络号（NetWork ID，NID），主机号（Host ID， HID）

IPv4定义了5类IP地址：A, B, C, D, E 类

![img](../image/1226410-20180117212839615-372307517.png)

<div align='center'>地址分类</div>

![img](../image/1226410-20180117213148584-457502837.png)

<div align='center'>地址分类范围</div>

#### 特殊的 ip 地址

1. 网络地址：用于表示网络本身，具有正常的网络号部分，而主机号部分全部为0的ip地址称之为网络地址，如172.16.45.0就是一个B类网络地址
2. 广播地址：用于向网络中的所有的设备进行广播。具有正常的网络号部分，而主机号部分全为1(即255)的ip地址称之为广播地址，如172.16.45.255就是一个B类的网络地址
3. 有限广播地址：指的是32位全位1(即255.255.255.255)的ip地址，用于本网广播
4. 回送地址：网络地址不能以十进制的127作为开头，在地址中数字127保留给系统作为诊断用，称为欢送地址，如127.0.0.1用于回路测试
5. 私有地址：只能在局域网内使用，不能在internet上使用的ip地址称为私有ip地址，私有ip地址有：
   1. 10.0.0.0～10.255.255.255，表示一个A类地址
   2. 172.16.0.0~172.31.255.255,表示16个B类地址
   3. 192.168.0.0～192.168.255.255，表示256个C类地址
6. 0.0.0.0:指已经不是真正意义上的ip地址，它表示的是所有不清楚主机和目的网络，这里的不清楚指的是在本机路由表里没有特定条目指明如何到达

#### 子网掩码

子网掩码是一个 32 位的 2 进制数，其对应网络地址的所有位置都是 1，对应与主机地址的所有位置都是 0。将子网掩码和 IP 地址按位进行逻辑与运算，得到 IP 地址的网络地址，剩下的部分就是主机地址，从而区分出任意 IP 地址中的网络地址和主机地址

![img](../image/1226410-20180117213852349-462938485.png)

<div align='center'>子网掩码</div>

#### ip 判断

子网掩码告知路由器，IP 地址的前多少位是网络地址，后多少位是主机地址，使路由器正确判断任意IP地址是否是本网段的，从而正确的进行路由，例子：

- 主机1： ip 221.21.160.5      子网掩码：255.255.255.192
- 主机2： ip 222.21.160.73    子网掩码：255.255.255.192

现在主机1 向 主机 2 发送数据，首先要判断两个主机是否在同一网段，逻辑与运算后，显然前三位的值都是  221.21.160，C 类地址判断前三位是否相同，即可确定2个IP地址是否在同一网段内，但本例中的222.21.160.6与222.21.160.73不在同一网段，因为这两个C类IP地址已经做了子网划分就不能只判断前三位是否相同就确认这两个IP是否在同一网段。其中222.21.160.6在222.21.160.1-222.21.160.62 段，222.21.160.73在222.21.160.65-222.21.160.126 段，所以不在同一网段[2] ，如果要通信需要通过路由器转发。

## 子网划分

#### 子网划分的概念

子网划分的定义：Internet 组织机构定义了五种 IP 地址，由 A, B, C 三类地址，每个 A 类网络可能由 1600 百多万台主机，它们处于同一广播域，而在同一广播域中由这么多节点是不可能的，网络会因为广播通信而饱和，结果造成大部分地址没有分配出去。可以基于每类的IP网络进一步的分成更小的网络。每个子网由路由器界定并分配一个新的子网网络地址，子网地址是借用基于每类的网络地址的主机部分创建的。划分子网后，通过使用掩码，把子网隐藏起来，使得从外部来看网络没有任何变化。

当我们对一个网络进行子网划分时，基本上就是将它分成小的[网络](https://baike.baidu.com/item/网络)。比如，当一组IP地址指定给一个公司时，公司可能将该网络“分割成”小的网络，每个部门一个。这样，技术部门和管理部门都可以有属于它们的小网络。通过划分子网，我们可以按照我们的需要将网络分割成小网络。这样也有助于降低流量和隐藏网络的复杂性。

子网划分是通过借用 ip 地址的若干位主机位来充当子网地址，从而将原来的网络分为若干个彼此隔离的子网实现的

![img](../image/1226410-20180117214150506-638807042.png)

<div align='center'>子网划分</div>

注意：

- arp 协议通过 ip 地址获取目标主机的mac地址这一过程是使用的广播的方式，这个广播地址就是通过子网地址于子网掩码计算而来的，只有计算出的这一子网内的主机才能收到这个 arp 广播包
- 子网划分和 vlan 都可以做到隔离广播域，只是子网划分是三层隔离，vlan 是二层隔离

#### c 类子网划分

![img](../image/1226410-20180117215023459-1762756045.png)

<div align='center'>c 类网络子网划分</div>

 划分子网时，随着子网地址借用主机位数的增多，子网的数目随之增加，而每个子网中的可用主机数逐渐减少。以C类网络为例，原有8位主机位，2的8次方即256个[主机地址](https://baike.baidu.com/item/主机地址)，默认[子网掩码](https://baike.baidu.com/item/子网掩码)255.255.255.0。借用1位[主机](https://baike.baidu.com/item/主机)位，产生2个子网，每个子网有126个主机地址；借用2位主机位，产生4个子网，每个子网有62个主机地址……每个网中，第一个IP地址（即主机部分全部为0的IP）和最后一个IP（即主机部分全部为1的IP）不能分配给主机使用，所以每个子网的可用IP地址数为总IP地址数量减2；根据子网ID借用的主机位数，我们可以计算出划分的子网数、[掩码](https://baike.baidu.com/item/掩码)、每个子网主机数，列表如下：

​     ① 划分子网数 ② 子网位数 ③子网掩码（二进制） ④ 子网掩码（十进制） ⑤ 每个子网主机数

​     ① 1～2 ② 1 ③ 11111111.11111111.11111111.10000000 ④ 255.255.255.128 ⑤ 126

　　  ① 3～4 ② 2 ③ 11111111.11111111.11111111.11000000 ④ 255.255.255.192 ⑤ 62

　　  ① 5～8 ② 3 ③ 11111111.11111111.11111111.11100000 ④ 255.255.255.224 ⑤ 30

　　  ① 9～16 ② 4 ③ 11111111.11111111.11111111.11110000 ④ 255.255.255.240 ⑤ 14

　　  ① 17～32 ② 5 ③ 11111111.11111111.11111111.11111000 ④ 255.255.255.248 ⑤ 6

　　  ① 33～64 ② 6 ③ 11111111.11111111.11111111.11111100 ④ 255.255.255.252 ⑤ 2

​     如上表所示的C类网络中，若子网占用7位主机位时，主机位只剩一位，无论设为0还是1，都意味着主机位是全0或全1。由于主机位全0表示本网络，全1留作[广播地址](https://baike.baidu.com/item/广播地址)，这时子网实际没有可用[主机地址](https://baike.baidu.com/item/主机地址)，所以主机位至少应保留2位。

#### 子网划分步骤

1. 确定要划分的子网数以及每个子网的主机数
2. 求出子网数目对应的二进制的位数 N 及主机数目对应的二进制数的位数 M
3. 对该ip地址的原子网掩码，将其主机地址部分的前N位置1(其余全部置0)或后M位置0(其余全置1)即得出该ip地址划分子网后的子网掩码

eg：给 C 类网络 211.168.10.0 划分 5 个子网

2**2-2<5<2**3-2所以需要3位网络号，主机号为8-3=5

子网掩码为255.255.255.224

每个子网可容纳2**5-2=30台主机

#### 为什么要子网划分

Internet组织机构定义了五种IP地址，用于主机的有A、B、C三类地址。其中A类网络有126个，每个A类网络可能有16，777，214台主机，它们处于同一广播域。而在同一广播域中有这么多结点是不可能的，网络会因为广播通信而饱和，结果造成16，777，214个地址大部分没有分配出去，形成了浪费。而另一方面，随着互连网应用的不断扩大，IP地址资源越来越少。为了实现更小的广播域并更好地利用主机地址中的每一位，可以把基于类的IP网络进一步分成更小的网络，每个子网由路由器界定并分配一个新的子网网络地址,子网地址是借用基于类的网络地址的主机部分创建的。划分子网后，通过使用掩码，把子网隐藏起来，使得从外部看网络没有变化，这就是子网掩码。

很简单的说  就是，一个公司不可能使用254个公网地址，A公司想用6个地址，B公司也想用6个地址，如果把这两个公司的地址都放在一个大网段里面，这两个公司的地址就能够直接互通

#### 子网划分的优点

- 减少网络流量
- 提高网络性能
- 简化管理
- 易于扩大地理范围 

#### 子网划分注意事项

1. 在子网划分时不仅需要考虑目前需要，还应该了解将来需要多说子网和主机。子网掩码使用较多的主机位，可以得到更多子网，节约了ip地址资源，若将来需要更多的子网时，不用再重新分配ip地址，但每个子网的主机数量有限；反之，子网掩码使用较少的主机位，每个子网的主机数允许有更大的增长，但可用子网数有限
2. 一般来说，一个网络中的节点数太多，网络会因为广播通信而饱和，所以网络中的主机数量的增长是有限的，也就是说，在条件允许的情况下，应将更多的主机位用于子网位